.TH MOLD 1
.SH NAME
mold \- A Modern Linker

.SH SYNOPSIS
mold [\fBoptions\fR] \fIobjfile\fR \fB...\fR

.SH DESCRIPTION
\fBmold\fR is a multi-threaded, high-performance linker that is
several times faster than the industry-standard ones, namely, GNU ld,
GNU gold or LLVM lld. It is developed as a drop-in replacement for
these linkers and command-line compatible with them with a few
exceptions.
.PP
Note that even though \fBmold\fR can build many userland programs,
including large ones such as Chrome and Firefox, it is still very
experimental. Do not use \fBmold\fR for production unless you know
what you are doing. \fBmold\fR supports Linux/x86-64 and Linux/i386.

.SS "How to use mold"
On Unix, \fBcc\fR (or \fBgcc\fR or \fBclang\fR, depending on what
compiler you use) is not just a C compiler but is actually a compiler
driver for various kinds of input files. \fBcc\fR dispatches based
on input file extensions. If you pass object files (\fB.o\fR files) to
a compiler driver, the linker command, which is usually installed as
\fB/usr/bin/ld\fR, is invoked as a backend.
.PP
To use an alternative linker, you have to modify a build config file
such as \fBMakefile\fR or \fBcargo.toml\fR to pass an appropriate
option to a compiler driver which invokes a linker. The problem is
that it is not always clear how to do that. In a complicated build
system, it can be very hard to figure out how to convince a system to
use a non-standard linker.
.PP
To deal with the situation, \fBmold\fR provides a convenient option to
force any build system to use \fBmold\fR. To use the feature, invoke
\fBmake\fR or a build command of your choice (such as \fBcargo
build\fR) as follows:
.PP
.Vb 1
\&        mold \-run make <make arguments if any>
.Ve
.PP
If you run a build command like above, the command runs under the
influence of \fBmold\fR so that when the command tries to run
\fB/usr/bin/ld\fR, \fB/usr/bin/ld.gold\fR or \fB/usr/bin/ld.lld\fR,
\fBmold\fR is silently invoked instead.
.PP
Internally, \fBmold\fR invokes a given command with the
\fBLD_PRELOAD\fR environment variable set to its companion shared
object file. The shared object file intercepts all \fBexec()\fR-family
functions to run \fBmold\fR if other linker is attempted to be run.
.PP
If you don't want to use the \fB\-run\fR option, and if you are using
\fBclang\fR, you can pass \fB\-fuse\-ld\fR=\fI/absolute/path/to/mold\fR to
\fBclang\fR to used \fBmold\fR. If you are using \fBgcc\fR, it looks
like there's unfortunately no easy way (other than \fB\-run\fR) to
force it to use \fBmold\fR, as \fBgcc\fR doesn't take an arbitrary
pathname as an argument for \fB\-fuse\-ld\fR.
.PP
I do not recommend installing \fBmold\fR as \fB/usr/bin/ld\fR
unless you know what you are doing.

.SS Compatibility
\fBmold\fR is designed to be a drop-in replacement for the GNU linkers
for linking user-land programs. If your user-land program cannot be
built due to missing command-line options, please file a bug at
\fBhttps://github.com/rui314/mold/issues\fR.
.PP
\fBmold\fR supports a very limited set of linker script features,
which is just sufficient to read
\fB/usr/lib/x86_64-linux-gnu/libc.so\fR on Linux systems (on Linux,
that file is despite its name not a shared library but an ASCII linker
script that loads a real \fBlibc.so\fR file!)
Beyond that, I have no plan to support any linker script features.
The linker script is an ad-hoc, over-designed, complex language which
I believe needs to be disrupted by a simpler mechanism. I have a plan
to add a replacement for the linker script to \fBmold\fR instead.

.SS Archive symbol resolution
Traditionally, Unix linkers are sensitive to the order in which input
files appear on command line. They process input files from the first
(leftmost) file to the last (rightmost) file one by one. While reading
input files, they maintain sets of defined and undefined symbols.
When visiting an archive file (\fB.a\fR files), they pull out object
files to resolve as many undefined symbols as possible and go on to
the next input file. Object files that weren't pulled out will never
have a chance for a second look.
.PP
Due to this semantics, you usually have to add archive files at the end
of a command line, so that when a linker reaches archive files, it
knows what symbols are remain undefined. If you put archive files at
the beginning of a command line, a linker doesn't have any undefined
symbol, and thus no object files will be pulled out from archives.
.PP
You can change the processing order by \fB\-\-start\-group\fR and
\fB\-\-end\-group\fR options, though they make a linker slower.
.PP
\fBmold\fR as well as LLVM \fBlld\fR linker take a different
approach. They memorize what symbols can be resolved from archive
files instead of forgetting it after processing each
archive. Therefore, \fBmold\fR and \fBlld\fR can "go back" in a
command line to pull out object files from archives, if they are
needed to resolve remaining undefined symbols. They are not sensitive
to the input file order.
.PP
\fB\-\-start\-group\fR and \fB\-\-end\-group\fR are still accepted
by \fBmold\fR and \fBlld\fR for compatibility with traditional linkers,
but they are silently ignored.

.SH OPTIONS
.IP "\fB\-\-help\fR"
Report usage information
.IP "\fB\-v\fR"
.PD 0
.IP "\fB\-\-version\fR"
.PD
Report version information
.IP "\fB\-V\fR"
Report version and target information
.IP "\fB\-C\fR \fIdir\fR"
.PD 0
.IP "\fB\-\-directory\fR \fIdir\fR"
.PD
Change to \fIdir\fR before doing anything
.IP "\fB\-E\fR"
.PD 0
.IP "\fB\-\-export\-dynamic\fR"
.PD
Put symbols in the dynamic symbol table
.IP "\fB\-\-no\-export\-dynamic\fR"
Do not put symbols in the dynamic symbol table
.IP "\fB\-F\fR \fIlibname\fR"
.PD 0
.IP "\fB\-\-filter\fR=\fIlibname\fR"
.PD
Set \fBDT_FILTER\fR to \fIlibname\fR
.IP "\fB\-I\fR\fIfile\fR"
.PD 0
.IP "\fB\-\-dynamic\-linker\fR=\fIfile\fR"
.PD
Set dynamic linker path
.IP "\fB\-\-no\-dynamic\-linker\fR"
Do not set dynamic linker path
.IP "\fB\-L\fR\fIdir\fR"
.PD 0
.IP "\fB\-\-library\-path\fR=\fIdir\fR"
.PD
Add \fIdir\fR to library search path
.IP "\fB\-M\fR"
.PD 0
.IP "\fB\-\-print\-map\fR"
.PD
Write map file to stdout
.IP "\fB\-N\fR"
.PD 0
.IP "\fB\-\-omagic\fR"
.PD
Do not page align data, do not make text readonly
.IP "\fB\-\-no\-omagic\fR"
Page align data, make text readonly
.IP "\fB\-S\fR"
.PD 0
.IP "\fB\-\-strip\-debug\fR"
.PD
Strip \fB.debug_*\fR sections
.IP "\fB\-T\fR \fIfile\fR"
.PD 0
.IP "\fB\-\-script\fR=\fIfile\fR"
.PD
Read linker script from \fIfile\fR
.IP "\fB\-X\fR"
.PD 0
.IP "\fB\-\-discard\-locals\fR"
.PD
Discard temporary local symbols
.IP "\fB\-e\fR\fIsymbol\fR"
.PD 0
.IP "\fB\-\-entry\fR=\fIsymbol\fR"
.PD
Set program entry point
.IP "\fB\-f\fR \fIshlib\fR"
.PD 0
.IP "\fB\-\-auxiliary\fR=\fIshlib\fR"
.PD
Set \fBDT_AUXILIARY\fR to \fIshlib\fR
.IP "\fB\-h\fR \fIlibname\fR"
.PD 0
.IP "\fB\-\-soname\fR\fIlibname\fR"
.PD
Set shared library name
.IP "\fB\-l\fR\fIlibname\fR"
Search for \fIlibname\fR
.IP "\fB\-o\fR \fIfile\fR"
.PD 0
.IP "\fB\-\-output\fR=\fIfile\fR"
.PD
Set output filename
.IP "\fB\-s\fR"
.PD 0
.IP "\fB\-\-strip\-all\fR"
.PD
Strip .symtab section
.IP "\fB\-u\fR \fIsymbol\fR"
.PD 0
.IP "\fB\-\-undefined\fR=\fIsymbol\fR"
.PD
Force to resolve \fIsymbol\fR
.IP "\fB\-\-Bdynamic\fR"
Link against shared libraries (default)
.IP "\fB\-\-Bstatic\fR"
Do not link against shared libraries
.IP "\fB\-\-Bsymbolic\fR"
Bind global symbols locally
.IP "\fB\-\-Bsymbolic\-functions\fR"
Bind global functions locally
.IP "\fB\-\-Map\fR=\fIfile\fR"
Write map file to a given file
.IP "\fB\-\-as\-needed\fR"
Only set \fBDT_NEEDED\fR if used
.IP "\fB\-\-no\-as\-needed\fR"
Always set \fBDT_NEEDED\fR
.IP "\fB\-\-build\-id\fR=[\fInone\fR,\fImd5\fR,\fIsha1\fR,\fIsha256\fR,\fIuuid\fR,\fIhexstring\fR]"
Generate build ID
.IP "\fB\-\-no\-build\-id\fR"
Do not generate build ID
.IP "\fB\-\-chroot\fR=\fIdir\fR"
Set \fIdir\fR to root directory
.IP "\fB\-\-compress\-debug\-sections\fR=[\fInone\fR,\fIzlib\fR,\fIzlib\-gabi\fR]"
Compress \fB.debug_*\fR sections
.IP "\fB\-\-demangle\fR"
Demangle C++ symbols in log messages (default)
.IP "\fB\-\-no\-demangle\fR"
Do not demangle
.IP "\fB\-\-dynamic\-list\fR"
Read a list of dynamic symbols
.IP "\fB\-\-eh\-frame\-hdr\fR"
Create \fB.eh_frame_hdr\fR section
.IP "\fB\-\-no\-eh\-frame\-hdr\fR"
Do not create \fB.eh_frame_hdr\fR section (default)
.IP "\fB\-\-exclude\-libs\fR=\fIlib,lib,..\fR"
Mark all symbols in given libraries hidden
.IP "\fB\-\-fini\fR=\fIsymbol\fR"
Call \fIsymbol\fR at unload-time
.IP "\fB\-\-fork\fR"
Spawn a child process (default)
.IP "\fB\-\-no\-fork\fR"
Do not spawn a child process
.IP "\fB\-\-gc\-sections\fR"
Remove unreferenced sections
.IP "\fB\-\-no\-gc\-sections\fR"
Do not remove unreferenced sections
.IP "\fB\-\-hash\-style\fR=[\fIsysv\fR,\fIgnu\fR,\fIboth\fR]"
Set hash style
.IP "\fB\-\-icf\fR"
Fold identical code
.IP "\fB\-\-no\-icf\fR"
Do not fold identical code
.IP "\fB\-\-image\-base\fR=\fIaddr\fR"
Set the base address to \fIaddr\fR
.IP "\fB\-\-init\fR=\fIsymbol\fR"
Call \fIsymbol\fR at load-time
.IP "\fB\-\-no\-undefined\fR"
Report undefined symbols (even with \fB\-\-shared\fR)
.IP "\fB\-\-perf\fR"
Print performance statistics
.IP "\fB\-\-pie\fR"
.PD 0
.IP "\fB\-\-pic\-executable\fR"
.PD
Create a position independent executable
.IP "\fB\-\-no\-pie\fR"
.PD 0
.IP "\fB\-\-no\-pic\-executable\fR"
.PD
Do not create a position independent executable
.IP "\fB\-\-pop\-state\fR"
Pop state of flags governing input file handling
.IP "\fB\-\-preload\fR"
Preload object files
.IP "\fB \-\-print\-gc\-sections\fR"
Print removed unreferenced sections
.IP "\fB\-\-no\-print\-gc\-sections\fR"
Do not print removed unreferenced sections (default)
.IP "\fB\-\-print\-icf\-sections\fR"
Print folded identical sections
.IP "\fB\-\-no\-print\-icf\-sections\fR"
Do not print folded identical sections
.IP "\fB\-\-push\-state\fR"
Pop state of flags governing input file handling
.IP "\fB\-\-quick\-exit\fR"
Use quick_exit to exit (default)
.IP "\fB\-\-no\-quick\-exit\fR"
Do not use quick_exit to exit
.IP "\fB\-\-relax\fR"
Optimize instructions (default)
.IP "\fB\-\-no\-relax\fR"
Do not optimize instructions
.IP "\fB\-\-repro\fR"
Embed input files to .repro section
.IP "\fB\-\-rpath\fR=\fIdir\fR"
Add \fIdir\fR to runtime search path
.IP "\fB\-\-run\fR \fIcommand arg ...\fR"
Run \fIcommand\fR with mold as \fB/usr/bin/ld\fR
.IP "\fB\-\-shared\fR"
.PD 0
.IP "\fB\-\-Bshareable\fR"
.PD
Create a share library
.IP "\fB\-\-spare\-dynamic\-tags\fR=\fInumber\fR"
Reserve give number of tags in .dynamic section
.IP "\fB\-\-static\fR"
Do not link against shared libraries
.IP "\fB\-\-stats\fR"
Print input statistics
.IP "\fB\-\-sysroot\fR=\fIdir\fR"
Set target system root directory
.IP "\fB\-\-thread\-count=\fIcount\fR\fR"
Use \fIcount\fR number of threads
.IP "\fB\-\-threads\fR"
Use multiple threads (default)
.IP "\fB\-\-no\-threads\fR"
Do not use multiple threads
.IP "\fB\-\-trace\fR"
Print name of each input file
.IP "\fB\-\-version\-script\fR=\fIfile\fR"
Read version script
.IP "\fB\-\-warn\-common\fR"
Warn about common symbols
.IP "\fB\-\-no\-warn\-common\fR"
Do not warn about common symbols
.IP "\fB\-\-whole\-archive\fR"
Include all objects from static archives
.IP "\fB\-\-no\-whole\-archive\fR"
Do not include all objects from static archives
.IP "\fB\-z now\fR"
Disable lazy function resolution
.IP "\fB\-z lazy\fR"
Enable lazy function resolution (default)
.IP "\fB\-z execstack\fR"
Require executable stack
.IP "\fB\-z noexecstack\fR"
Do not require executable stack (default)
.IP "\fB\-z relro\fR"
Make some sections read-only after relocation (default)
.IP "\fB\-z norelro\fR"
Do not use relro
.IP "\fB\-z defs\fR"
Report undefined symbols (even with \fI\-\-shared\fR)
.IP "\fB\-z nodefs\fR"
Do not report undefined symbols
.IP "\fB\-z nodlopen\fR"
Mark DSO not available to dlopen
.IP "\fB\-z nodelete\fR"
Mark DSO non-deletable at runtime
.IP "\fB\-z nocopyreloc\fR"
Do not create copy relocations
.IP "\fB\-z initfirst\fR"
Mark DSO to be initialized first at runtime
.IP "\fB\-z interpose\fR"
Mark object to interpose all DSOs but executable

.IP "\fB\-(\fR"
.PD 0
.IP "\fB\-)\fR"
.IP "\fB\-O\fR\fInumber\fR"
.IP "\fB\-m\fR \fIemulation\fR"
.IP "\fB\-\-allow\-multiple\-definition\fR"
.IP "\fB\-\-allow\-shlib\-undefined\fR"
.IP "\fB\-\-color\-diagnostics\fR"
.IP "\fB\-\-disable\-new\-dtags\fR"
.IP "\fB\-\-enable\-new\-dtags\fR"
.IP "\fB\-\-end\-group\fR"
.IP "\fB\-\-fatal\-warnings\fR"
.IP "\fB\-\-gdb\-index\fR"
.IP "\fB\-\-no\-allow\-shlib\-undefined\fR"
.IP "\fB\-\-no\-copy\-dt\-needed\-entries\fR"
.IP "\fB\-\-no\-fatal\-warnings\fR"
.IP "\fB\-\-plugin\-opt\fR"
.IP "\fB\-\-plugin\fR"
.IP "\fB\-\-rpath\-link\fR=\fIdir\fR"
.IP "\fB\-\-sort\-common\fR"
.IP "\fB\-\-sort\-section\fR"
.IP "\fB\-\-start\-group\fR"
.PD
Ignored

.SH BUGS
Report bugs at \fBhttps://github.com/rui314/mold/issues\fR.

.SH AUTHOR
Rui Ueyama <\fBruiu@cs\&.stanford\&.edu\fR>

.SH "SEE ALSO"
.BR ld (1),
.BR gold (1),
.BR ld.so (8)
